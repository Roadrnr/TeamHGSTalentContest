<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    
<script src="js/azurev10/azure-storage.blob.js"></script>
<script>
    // Steps to run this sample
// 1. npm install
// 2. Enter your storage account name, SAS and a path pointing to local file in main()

const fs = require("fs");
const {
  AnonymousCredential,
  uploadBrowserDataToBlockBlob,
  downloadBlobToBuffer,
  uploadFileToBlockBlob,
  uploadStreamToBlockBlob,
  Aborter,
  BlobURL,
  BlockBlobURL,
  ContainerURL,
  ServiceURL,
  StorageURL
} = require(".."); // Change to "@azure/storage-blob" in your package

async function main() {
  // Fill in following settings before running this sample
  const account = "account";
  const accountSas = "accountSas";
  const localFilePath = "localFilePath";

  const pipeline = StorageURL.newPipeline(new AnonymousCredential(), {
    // httpClient: MyHTTPClient, // A customized HTTP client implementing IHttpClient interface
    // logger: MyLogger, // A customized logger implementing IHttpPipelineLogger interface
    retryOptions: { maxTries: 4 }, // Retry options
    telemetry: { value: "HighLevelSample V1.0.0" } // Customized telemetry string
  });

  const serviceURL = new ServiceURL(
    `https://${account}.blob.core.windows.net${accountSas}`,
    pipeline
  );

  // Create a container
  const containerName = `newcontainer${new Date().getTime()}`;
  const containerURL = ContainerURL.fromServiceURL(serviceURL, containerName);
  await containerURL.create(Aborter.none);

  // Create a blob
  const blobName = "newblob" + new Date().getTime();
  const blobURL = BlobURL.fromContainerURL(containerURL, blobName);
  const blockBlobURL = BlockBlobURL.fromBlobURL(blobURL);



  // Parallel uploading a browser File/Blob/ArrayBuffer in browsers with uploadBrowserDataToBlockBlob
  // Uncomment following code in browsers because uploadBrowserDataToBlockBlob is only available in browsers

  const browserFile = document.getElementById("fileinput").files[0];
  await uploadBrowserDataToBlockBlob(Aborter.none, browserFile, blockBlobURL, {
    blockSize: 4 * 1024 * 1024, // 4MB block size
    parallelism: 20, // 20 concurrency
    progress: ev => console.log(ev)
  });


  // Delete container
  await containerURL.delete(Aborter.none);
  console.log("deleted container");
}

// An async method returns a Promise object, which is compatible with then().catch() coding style.
main()
  .then(() => {
    console.log("Successfully executed sample.");
  })
  .catch(err => {
    console.log(err.message);
  });
</script>
</body>
</html>